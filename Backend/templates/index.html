<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
        <link rel="icon" type="image/png" href="{{url_for('static', filename='images/favicon-16x16.png')}}" sizes="16x16" />
        <title>Drag and Drop File Upload</title>

        <!-- CHANGE THE ACTION TO THE PHP SCRIPT THAT WILL PROCESS THE FILE VIA AJAX -->
<form id="file-upload-form" action="<?php echo $_SERVER['PHP_SELF'] ?>">
	<input id="file-upload" type="file" name="fileUpload" />
	<label for="file-upload" id="file-drag">
		Select a file to upload
		<br />OR
		<br />Drag a file into this box

		<br /><br /><span id="file-upload-btn" class="button">Add a file</span>
	</label>

	<progress id="file-progress" value="0">
		<span>0</span>%
	</progress>

	<output for="file-upload" id="messages"></output>
</form>

<?php
$fn = (isset($_SERVER['HTTP_X_FILE_NAME']) ? $_SERVER['HTTP_X_FILE_NAME'] : false);
$targetDir = 'tmp/';

if ($fn) {
          	if (isFileValid($fn)) {
          		// AJAX call
          		file_put_contents(
          			$targetDir . $fn,
          			file_get_contents('php://input')
          		);
          		removeFile($fn);
          	}
}

function removeFile($file) {
	unlink($targetDir . $file);
}
?>
    </head>
    <body>

       

        <!-- Suchformular -->
        <form method="POST">
            {{ search_form.hidden_tag() }}
            {{ search_form.query.label }}: {{ search_form.query() }}
            {{ search_form.search_submit() }}
        </form>

        <!-- Anzeige der Suchergebnisse -->
        {% if files %}
            <h2>Search Results:</h2>
            <ul>
                {% for file in files %}
                    <li>
                        <!-- Korrigiere das Argument 'filename' zu 'file_name' und entferne die Dateierweiterung -->
                        <a href="{{ url_for('show_pdf', file_name=file.replace('.pdf', '')) }}">{{ file }}</a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No results found.</p>
        {% endif %}

        <!-- Container für die Galerie mit horizontaler Scrollbar -->
        <div class="gallery-container">
            <div class="gallery">
                {% for img, pdf in images_to_pdfs.items() %}
                    <div class="image-container">
                        <a href="{{ url_for('show_pdf', file_name=pdf.replace('.pdf', '')) }}" class="image-button">
                            <img src="{{ url_for('static', filename='covers/' + img) }}" alt="Cover image of {{ pdf }}" style="height: 300px; width: 200px;">
                        </a>
                        <!-- Löschen-Button über dem Bild -->
                        <button class="delete-button" data-file-name="{{ pdf.replace('.pdf', '') }}">Delete</button>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- JQuery einbinden -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- Einbinden Ihrer externen script.js Datei -->
        <script src="{{ url_for('static', filename='scripts/script.js') }}"></script>

        <!-- Formular zum Hochladen von Dateien -->
        <form method="POST" enctype="multipart/form-data">
            {{ upload_form.hidden_tag() }}
            {{ upload_form.file.label }}: <input type="file" name="{{ upload_form.file.name }}" accept="application/pdf">
            {{ upload_form.submit() }}
        </form>

    </body>
</html>